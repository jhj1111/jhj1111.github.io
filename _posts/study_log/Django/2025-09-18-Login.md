---
title: (Django) 8. Login 구현
post_order: 8
thumbnail: https://learndjango.com/static/images/tutorials/login_logout/admin-login-testuser.png
layout: post
author: jhj
categories:
  - StudyLog
  - Django
tags:
  - Django
  - Rest Framework
  - command
excerpt: Django Login 구현, DB(User)활용 및 google 연동
project_rank: "680"
sticker: emoji//1 f 4 aa
---

# requirements&settings

- django-allauth, requests, jwt, PyJWT

```python
INSTALLED_APPS = [
...
    "django.contrib.sites",
    

    "allauth",
    "allauth.account",
    "allauth.socialaccount",
    "allauth.socialaccount.providers.google",
...
]

...
MIDDLEWARE = [
    "allauth.account.middleware.AccountMiddleware",
]

...

AUTHENTICATION_BACKENDS = (
    'django.contrib.auth.backends.ModelBackend',
    'allauth.account.auth_backends.AuthenticationBackend',
)
SIE_ID = 1
# deprecated
# ACCOUNT_EMAIL_REQUIRED = True
ACCOUNT_SIGNUP_FIELDS = ['email*', 'username*', 'password1*', 'passwords2*']
ACCOUNT_EMAIL_VERIFICATION = 'none'
LOGIN_REDIRECT_URL = '/blog/'
LOGOUT_REDIRECT_URL = '/blog/'

...
```

## google register

- [구글 클라우드 api 서비스](https://console.developers.google.com/)
- api - auth 인증 - 클라이언트 생성
- JSON(인증정보) 다운로드 반드시 실행
    - 못했을 시 삭제 후 재생성

![image.png](/assets/images/study_log/Django/2025-09-18-Login/image.png)

---

![image.png](/assets/images/study_log/Django/2025-09-18-Login/image%201.png)

## Admin

- 생성 완료 시 admin 화면에 SITES, SOCIAL_ACCOUNTS 항목 활성화

![image.png](/assets/images/study_log/Django/2025-09-18-Login/image%202.png)

- SITES 항목 추가
    - 기존의 example.com → localhost, 이름 변경(이름은 아무거나)

![image.png](/assets/images/study_log/Django/2025-09-18-Login/image%203.png)

- Social application 항목 추가
    - google cloud auth의 json 항목 작성
    - client id : client_id
    - Secret Key : client_secret

![image.png](/assets/images/study_log/Django/2025-09-18-Login/image%204.png)

# 접속 확인 authontification

## html

- {% raw %}`{% load socialaccount %}`{% endraw %} : load django-allauth
- {% raw %}`href="{% provider_login_url 'google' %}"`{% endraw %} : google account 연결
- `user.is_authenticated` : 로그인 상태 확인
{% raw %}
```html
# blog\templates\include\nav.html

{% load socialaccount %}
...
<!-- 유저 정보 display -->
<ul class="navbar-nav ms-auto">
	{% if user.is_authenticated %}
	<li class="nav-item">user : {{ user.username }}</li>
		<a class="nav-link" href="/accounts/logout/">
			logout
		</li>
		
	{% else %}
	<li class="nav-item">
		<a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">Log in</a>
	</li>
	{% endif %}
...
```
{% endraw %}
- 댓글
{% raw %}
```html
# blog\templates\blog\detail.html
{% load socialaccount %}
...
{% if user.is_authenticated and comment.author == user %}
    <div class="col-lg-2">
        <a href='/blog/{{ post_pk.pk }}/comment_update/{{ comment.id }}' class="mb-4">
            <input type='submit' value='수정' class="btn btn-primary"></input>
        </a>
    </div>

    <div class="col-lg-1">
        <a href='/blog/{{ post_pk.pk }}/comment_delete/{{ comment.id }}' class="mb-4">
            <input type='submit' value='삭제' class="btn btn-primary"></input>
        </a>
    </div>
{% endif %}
...
```
{% endraw %}
## backend(views)

```python
# blog\views.py

from django.contrib.auth.decorators import login_required

@login_required(login_url='/accounts/google/login/')
def detail(request, pk, commentform=None):
    category_total_list = Category.objects.all() # db SELECT * FROM POST ... ASC
    post_pk = Post.objects.get(pk=pk)
    comments = Comment.objects.filter(post=post_pk).order_by('created_date')
    commentform = CommentForm() if commentform is None else commentform
    
    return render(request,
                  template_name='blog/detail.html',
                  context={'post_pk':post_pk,
                        'categories' : category_total_list,
                        'comments' : comments,
                        'commentform' : commentform,
                        }
                  )
```